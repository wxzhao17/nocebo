---
title: "Anaylysis Process for MSc Dissertation"
author: "PSY6009_200256720_Webster"
date: "August 2021"
output:
  html_document: default
---

<br>

<br>

# **1 Introduction**
- - - 

## 1.1 Background

*MSc Dissertation*

It is the analysis part for my MSc dissertation *The Nocebo effect in the COVID-19 Pandemic: the role of information spreading*.   

The aims of this research are 

(1) to examinate the effects of different sources of information in nocebo effect during the COVID-19 pandemic; 

(2) to conduct a quantitative study to provide empirical evidence supporting the theoretical framework from Amanzio et al. (2020).

<br>

*Programming environment*

 +  Software environment: [R](https://www.r-project.org/) version 4.1.0
 +  Integrated development environment: [RStudio](https://www.rstudio.com/) version 1.4.1103

```{r}
# check the information for programming
sessionInfo()
```


<br>

## 1.2 Data Origin

The data used in this study was from the longitudinal survey via Internet across 4 waves of the COVID-19 psychological research consortium (C19PRC) study.

<br>

## 1.3 Research Questions **will be revised**

(1) **Were there more people who knew more non-authority information about COVID-19 thinking themselves had COVID-19 than people who knew less non-authority information about COVID-19?**

<br>

(2) **Were there more people who knew more authority information about COVID-19 thinking themselves had not COVID-19 than people who knew less authority information about COVID-19?**

<br>

(3) **Did knowing information about COVID-19 in different scources have interaction with trusting information about COVID-19 on nocebo response to COVID-19?**

<br>

(4) **Did anxiety to COVID-19 have indirect effect on nocebo response to COVID-19? (from knowing information about COVID-19 to anxiety to COVID-19, and from anxiety to COVID-19 to nocebo response to COVID-19)**

<br>

(5) **After controlling other variables, did the model still have significant effect?**

<br>

<br>

<br> 

# **2 Data Preparations**
_ _ _

## 2.1 load the data
```{r, echo=TRUE,results='hide',error=FALSE,message=FALSE,warning=FALSE}
# prepare the packages with specific functions
# find the location of the files in the project
library(here)

# help to manage the data
library(tidyverse)
library(knitr)
```
<br>
```{r}
# use the packages to load the original data
# load the original data and name it as "nocebo_0"
nocebo_0<- read.csv(here("data","COVID W1_W2_W3_W4 Cleaned 4949.csv"))

# check the numbers of observations and variables
dim(nocebo_0)

# check the first 5 rows and 5 columns of the original data "nocebo_0"
head(nocebo_0)[1:5]

# there is an error in the name of the first column, rename and check it again
colnames(nocebo_0)[1] = "New_PID"

head(nocebo_0)[1:5]

```
<br>

## 2.2 Select the sample and recode the variables

Firstly, I select variables used in this research and the qualified participants presented in wave 1 and wave 3 recontacts.And I recode and rename the variables.
```{r}
# sample from wave 1 and wave 3 recontacts
# save these data with the name of "df1"
df1<- nocebo_0 %>% 
  # select the variables
  select(
    # unique ID of every participant
    New_PID, 
    
    # participants in wave 3 recontacts
    W3Re_Present,
    
    # Sourcing of information measured in wave 1
    W1_INFO_1, W1_INFO_2, W1_INFO_3, W1_INFO_4,
    W1_INFO_5, W1_INFO_6, W1_INFO_7, W1_INFO_8,W1_INFO_9,
    
    # Level of trust in information source measured in wave 1
    W1_TRUST_1, W1_TRUST_2, W1_TRUST_3, W1_TRUST_4,
    W1_TRUST_5, W1_TRUST_6, W1_TRUST_7, W1_TRUST_8, W1_TRUST_9,
    
    # Anxiety-level relating to COVID-19 in wave 3 
    W3_COVID19_anxiety,
    
    # Experience of being infected with COVID-19 (self) in wave 3
    W3_C19_Infected, W3_Infected_Unsure, W3_Infected_Yes,
    
    # control variables
    W3_Age_year, W3_Age_categories, W3_Gender_binary, W1_Income_2019,
    W1_Dx_health_preC19, W3_GAD_Cat,
    W3_GAD_1, W3_GAD_2, W3_GAD_3, W3_GAD_4,
    W3_GAD_5, W3_GAD_6, W3_GAD_7) %>% 
  
  # select the qualified participants
  filter(
    # select the participants presented in wave 1 and wave 3
    W3Re_Present == "1" &
      
    # select those having subjective judgment of COVID-19 infection   
    W3_C19_Infected >= "1" & W3_Infected_Yes < "2") %>% 
  
  # recode the variables
  mutate(
    # "source" represent the source of the sample
    source = ifelse(W3Re_Present == "1", 1),
    
    # "sub_infected" represent the nocebo response to COVID-19 
    # "0" = Thought they have not had COVID-19, "1" = Thought they have had COVID-19
    sub_infected = ifelse(W3_Infected_Unsure == "1", 0, 1),
    
    # "health" represent the healthy problem
    # Due to the scale of this item measured in wave 1 is different to those measured in wave 3 and 4, recode it and keep the scale consistent.
    # "0" = No, "1" = Yes
    health = ifelse(W1_Dx_health_preC19 == "2", 0, 1),
    
    # "gender" represent the gender binary
    # recode gender into 0/1, which is convenient for the analysis.
    # "0"= male, "1" = female
    gender = ifelse(W3_Gender_binary == "1", 0, 1)) %>% 
  
  # rename the variables
  rename( 
    id = New_PID ,
    
    info_1 = W1_INFO_1, info_2 = W1_INFO_2, info_3 = W1_INFO_3, 
    info_4 = W1_INFO_4, info_5 = W1_INFO_5, info_6 = W1_INFO_6, 
    info_7 = W1_INFO_7, info_8 = W1_INFO_8, info_9 = W1_INFO_9,
    
    trust_1 = W1_TRUST_1, trust_2 = W1_TRUST_2, trust_3 = W1_TRUST_3, 
    trust_4 = W1_TRUST_4, trust_5 = W1_TRUST_5, trust_6 = W1_TRUST_6,
    trust_7 = W1_TRUST_7, trust_8 = W1_TRUST_8, trust_9 = W1_TRUST_9,
    
    c19_anxiety = W3_COVID19_anxiety,
    
    age_year = W3_Age_year, age_cate = W3_Age_categories, 
    income = W1_Income_2019, gad = W3_GAD_Cat,
    gad_1 = W3_GAD_1, gad_2 = W3_GAD_2, gad_3 = W3_GAD_3, 
    gad_4 = W3_GAD_4, gad_5 = W3_GAD_5, gad_6 = W3_GAD_6, gad_7 = W3_GAD_7)


# check the numbers of observations and variables
dim(df1)

# randomly check the 5 rows of df1
sample_n(df1, 5)
```

<br>

Next, I repeat this process to select the qualified participants in wave 3 top-ups, wave 4 top-ups and boosters, respectively.

```{r}
# sample from wave 3 top-ups
# save these data with the name of "df2"
df2<- nocebo_0 %>% 
  # select the variables
  select(
    # unique ID of every participant
    New_PID, 
    
    # participants in wave 3 top-ups
    W3Top_Present,
    
    # Sourcing of information measured in wave 3
    W3_INFO_1, W3_INFO_2, W3_INFO_3, W3_INFO_4,
    W3_INFO_5, W3_INFO_6, W3_INFO_7, W3_INFO_8, W3_INFO_9,
    
    # Level of trust in information source measured in wave 3
    W3_TRUST_1, W3_TRUST_2, W3_TRUST_3, W3_TRUST_4,
    W3_TRUST_5, W3_TRUST_6, W3_TRUST_7, W3_TRUST_8, W3_TRUST_9,
    
    # Anxiety-level relating to COVID-19 in wave 3 
    W3_COVID19_anxiety,
    
    # Experience of being infected with COVID-19 (self) in wave 3
    W3_C19_Infected, W3_Infected_Unsure, W3_Infected_Yes,
    
    # control variables
    W3_Age_year, W3_Age_categories, W3_Gender_binary, IW3_ncome_2019,
    W3_Chronic_illness_self, W3_GAD_Cat,
    W3_GAD_1, W3_GAD_2, W3_GAD_3, W3_GAD_4,
    W3_GAD_5, W3_GAD_6, W3_GAD_7) %>% 
  
  # select the qualified participants
  filter(
    # select the participants presented in wave 3 top-ups
    W3Top_Present == "1" &
      
    # select those having subjective judgment of COVID-19 infection   
    W3_C19_Infected >= "1" & W3_Infected_Yes < "2") %>% 
  
  # recode the variables
  mutate(
    # "source" represent the source of the sample
    source = ifelse(W3Top_Present == "1", 2),
    
    # "sub_infected" represent the nocebo response to COVID-19 
    # "0" = Thought they have not had COVID-19, "1" = Thought they have had COVID-19
    sub_infected = ifelse(W3_Infected_Unsure == "1", 0, 1),
     
    # "gender" represent the gender binary
    # recode gender into 0/1, which is convenient for the analysis.
    # "0"= male, "1" = female
    gender = ifelse(W3_Gender_binary == "1", 0, 1)) %>% 
  
  # rename the variables
  rename(
    id = New_PID ,
    
    info_1 = W3_INFO_1, info_2 = W3_INFO_2, info_3 = W3_INFO_3, 
    info_4 = W3_INFO_4, info_5 = W3_INFO_5, info_6 = W3_INFO_6, 
    info_7 = W3_INFO_7, info_8 = W3_INFO_8, info_9 = W3_INFO_9,
    
    trust_1 = W3_TRUST_1, trust_2 = W3_TRUST_2, trust_3 = W3_TRUST_3, 
    trust_4 = W3_TRUST_4, trust_5 = W3_TRUST_5, trust_6 = W3_TRUST_6,
    trust_7 = W3_TRUST_7, trust_8 = W3_TRUST_8, trust_9 = W3_TRUST_9,
    
    c19_anxiety = W3_COVID19_anxiety,
    
    age_year = W3_Age_year, age_cate = W3_Age_categories, income = IW3_ncome_2019, 
    gad = W3_GAD_Cat, health = W3_Chronic_illness_self,
    gad_1 = W3_GAD_1, gad_2 = W3_GAD_2, gad_3 = W3_GAD_3, 
    gad_4 = W3_GAD_4, gad_5 = W3_GAD_5, gad_6 = W3_GAD_6, gad_7 = W3_GAD_7)


# check the numbers of observations and variables
dim(df2)

# randomly check the 5 rows of df2
sample_n(df2, 5)


```

<br>

```{r}
# sample from wave 4 top-ups and boosters
# save these data with the name of "df3"
df3<- nocebo_0 %>% 
  # select the variables
  select(
    # unique ID of every participant
    New_PID, 
    
    # participants in wave 4
    W4_Type,
    
    # Sourcing of information measured in wave 4
    W4_INFO_1, W4_INFO_2, W4_INFO_3, W4_INFO_4,
    W4_INFO_5, W4_INFO_6, W4_INFO_7, W4_INFO_8, W4_INFO_9,
    
    # Level of trust in information source measured in wave 4
    W4_TRUST_1, W4_TRUST_2, W4_TRUST_3, W4_TRUST_4,
    W4_TRUST_5, W4_TRUST_6, W4_TRUST_7, W4_TRUST_8, W4_TRUST_9,
    
    # Anxiety-level relating to COVID-19 in wave 4 
    W4_COVID19_anxiety,
    
    # Experience of being infected with COVID-19 (self) in wave 4
    W4_C19_Infected, W4_Infected_Unsure, W4_Infected_Yes,
    
    # control variables
    W4_Age_year, W4_Age_categories, W4_Gender_binary, W4_Income_2019,
    W4_Chronic_illness_self, W4_GAD_Cat,
    W4_GAD1, W4_GAD2, W4_GAD3, W4_GAD4,
    W4_GAD5, W4_GAD6, W4_GAD7) %>% 
  
  # select the qualified participants
  filter(
    # select the participants presented in wave 4 top-ups and boosters
    W4_Type >= "2" &
      
    # select those having subjective judgment of COVID-19 infection   
    W4_C19_Infected >= "1" & W4_Infected_Yes < "2") %>% 
  
  # recode the variables
  mutate(
    # "source" represent the source of the sample
    source = ifelse(W4_Type == "2", 3,4),
    
    # "sub_infected" represent the nocebo response to COVID-19 
    # "0" = Thought they have not had COVID-19, "1" = Thought they have had COVID-19
    sub_infected = ifelse(W4_Infected_Unsure == "1", 0, 1),
     
    # "gender" represent the gender binary
    # recode gender into 0/1, which is convenient for the analysis.
    # "0"= male, "1" = female
    gender = ifelse(W4_Gender_binary == "1", 0, 1)) %>% 
  
  # rename the variables
  rename(
    id = New_PID ,
    
    info_1 = W4_INFO_1, info_2 = W4_INFO_2, info_3 = W4_INFO_3, 
    info_4 = W4_INFO_4, info_5 = W4_INFO_5, info_6 = W4_INFO_6, 
    info_7 = W4_INFO_7, info_8 = W4_INFO_8, info_9 = W4_INFO_9,
    
    trust_1 = W4_TRUST_1, trust_2 = W4_TRUST_2, trust_3 = W4_TRUST_3, 
    trust_4 = W4_TRUST_4, trust_5 = W4_TRUST_5, trust_6 = W4_TRUST_6,
    trust_7 = W4_TRUST_7, trust_8 = W4_TRUST_8, trust_9 = W4_TRUST_9,
    
    c19_anxiety = W4_COVID19_anxiety,
    
    age_year = W4_Age_year, age_cate = W4_Age_categories, income = W4_Income_2019, 
    gad = W4_GAD_Cat, health = W4_Chronic_illness_self,
    gad_1 = W4_GAD1, gad_2 = W4_GAD2, gad_3 = W4_GAD3, 
    gad_4 = W4_GAD4, gad_5 = W4_GAD5, gad_6 = W4_GAD6, gad_7 = W4_GAD7)


# check the numbers of observations and variables
dim(df3)

# randomly check the 5 rows of df3
sample_n(df3, 5)

```

<br>

## 2.3 Synthese the data
```{r}
# first remove the redundant variables and keep the same numbers and names of variables of every dataset
df1 <- df1 %>% 
  select(-W3Re_Present, -W3_C19_Infected, -W3_Infected_Unsure, 
         -W3_Infected_Yes, -W3_Gender_binary, -W1_Dx_health_preC19)

df2 <- df2 %>% 
  select(-W3Top_Present, -W3_C19_Infected, -W3_Infected_Unsure, 
         -W3_Infected_Yes, -W3_Gender_binary)

df3 <- df3 %>% 
  select(-W4_Type, -W4_C19_Infected, -W4_Infected_Unsure, 
         -W4_Infected_Yes, -W4_Gender_binary)

# synthesize 3 datasets into one and name it as "nocebo_1"
nocebo_1 <- rbind(df1,df2,df3)

# check the numbers of observations and variables
dim(nocebo_1)

# check the participants
nocebo_1 %>% 
  group_by(source) %>% 
  summarise(n = list(source),mean_age = mean(age_year), sd_age = sd(age_year), mean_gender = mean(gender))

# randomly check the 5 rows of nocebo_1
sample_n(nocebo_1,5)
```

<br>

## 2.4 Reliability analysis   
```{r,echo=TRUE,results='hide',error=FALSE,message=FALSE,warning=FALSE}
# load the packages
library(psych)
```


```{r}
# select the items measured "Sourcing of information"
df4 <- nocebo_1 %>% 
  select(info_1, info_2, info_3, info_4, info_5, info_6, info_7, info_8, info_9)

# calculate the Cronbach's alpha of "Sourcing of information"
alpha(df4, check.keys=TRUE)

# select the items measured "Level of trust in information source"
df5 <- nocebo_1 %>% 
  select(trust_1, trust_2, trust_3, trust_4, trust_5, trust_6, trust_7, trust_8, trust_9)

# calculate the Cronbach's alpha of "Level of trust in information source"
alpha(df5, check.keys=TRUE)


# select the items measured "Generalized Anxiety Disorder"
df6 <- nocebo_1 %>% 
  select(gad_1, gad_2, gad_3, gad_4, gad_5, gad_6, gad_7)

# calculate the Cronbach's alpha of "Generalized Anxiety Disorder"
alpha(df6, check.keys=TRUE)    

```

## 2.5 Calculate the variables

```{r}
# rescale the item of "anxiety to COVID-19" to range from 0 to 1 
nocebo_1$c19_anxiety = nocebo_1$c19_anxiety*0.01

# calculate the sum of knowing information about COVID-19 and trust in information from authority sources
nocebo_1$total_info = apply(nocebo_1[,2:10],1,sum)

nocebo_1$total_trust = apply(nocebo_1[,11:19],1,sum)

# calculate the sum of knowing information about COVID-19 and trust in information from authority sources
nocebo_1$a_info = apply(nocebo_1[,7:9],1,sum)

nocebo_1$a_trust = apply(nocebo_1[,16:18],1,sum)

# calculate the sum of knowing information about COVID-19 and trust in information from non-authority sources
nocebo_1$na_info = apply(nocebo_1[,c(2:6,10)],1,sum)

nocebo_1$na_trust = apply(nocebo_1[,c(11:15,19)],1,sum)

```

## 2.6 Data description

```{r}
# reorder the columns
nocebo_2 <- nocebo_1 %>% 
  select(id,
         info_1, info_2, info_3, info_4, info_5, info_9, info_6, info_7, info_8,
         trust_1, trust_2, trust_3, trust_4, trust_5, trust_9, trust_6, trust_7, trust_8,
         total_info,total_trust, a_info, a_trust, na_info, na_trust,
         c19_anxiety, sub_infected, source,
         age_year, age_cate, gender, income, health, gad)

# randomly check the 5 rows of nocebo_2
sample_n(nocebo_2,5)
```

| Variable | Description | 
|----:|:-----------|
|id|Unique number of every participant.|
|info_1|(*Non-authority*)The amount of information about COVID-19 that the participants obtained from *newspaper*.|
|info_2|(*Non-authority*)The amount of information that the participants obtained from *television*.|

**not completed yet**


<br>

<br>

<br> 

# **3 Preliminary Analysis**
_ _ _


## 3.1 Descriptive statistics
```{r}
#sample size (mean, SD)
describe(nocebo_2)

```

## 3.2 Correlations martix
```{r}
#variables 
corr.test(nocebo_2[,c(20,21,26,27)])

corr.test(nocebo_2[,22:27])
```

## 3.3 Data visualizations 

*<1>Univariate plots* 
```{r}
# anxiety
plot(density(nocebo_2$c19_anxiety), main="anxiety to COVID-19")


#sub_infected

table(nocebo_2$sub_infected)

# probably can remove this graph
plot(1:474,dbinom(1:474,0.84, size=474), 
     xlab='N of participants thought having COVID-19', ylab='Probability', type='l')



```

*<2>Bivariate plots*  

```{r}
# change the codes with ggplot2 [need improvement]
plot(nocebo_2$total_info,jitter(nocebo_2$c19_anxiety, 0))

plot(nocebo_2$total_trust,jitter(nocebo_2$c19_anxiety, 0))

plot(nocebo_2$total_info,jitter(nocebo_2$sub_infected, 0.5))


```


<br>

<br>

<br> 

# **4 Main Analysis**
_ _ _

## 4.0 Preparation for the interaction
```{r}

# calculate the interaction of information and trust with centering 
nocebo_2 <- nocebo_2 %>% 
  mutate(info_trust = 
           ((info_1-mean(info_1))*(trust_1-mean(trust_1)) + (info_2-mean(info_2))*(trust_2-mean(trust_2))
            +(info_3-mean(info_3))*(trust_3-mean(trust_3))+ (info_4-mean(info_4))*(trust_4-mean(trust_4))
            +(info_5-mean(info_5))*(trust_5-mean(trust_5))+ (info_6-mean(info_6))*(trust_6-mean(trust_6))
            +(info_7-mean(info_7))*(trust_7-mean(trust_7))+ (info_8-mean(info_8))*(trust_8-mean(trust_8))
            +(info_9-mean(info_9))*(trust_9-mean(trust_9))))

# centering the variables
#nocebo_2$total_info_c <- scale(nocebo_2$total_info, center = TRUE, scale = FALSE)
#nocebo_2$total_trust_c <- scale(nocebo_2$total_trust, center = TRUE, scale = FALSE)

```


## 4.1 Part A: Total information

### 4.1.1 linear regression to COVID-19 anxiety
```{r}
lm1 <- lm(c19_anxiety~total_info + total_trust + info_trust, data = nocebo_2)
summary(lm1)

```


### 4.1.2 logistic regression to subjected infection with COVID-19

```{r}
glm1<-glm(sub_infected~total_info + total_trust + info_trust + c19_anxiety, data=nocebo_2, family=binomial(link='logit')) 
summary(glm1)
```


### 4.1.3 SEM model

```{r,echo=TRUE,results='hide',error=FALSE,message=FALSE,warning=FALSE}
# load the package to analyze the path model
library(lavaan)
```

```{r}
# some problems with the centered variables "info_trust"
model1 <-'
c19_anxiety ~ total_info  + total_trust + info_trust
sub_infected~total_info  + total_trust + info_trust + c19_anxiety
'
fit1 <- sem(model1, ordered = c("sub_infected"), data = nocebo_2)
summary(fit1, fit.measures = TRUE)
```

the p values in "lm" and "glm" regression are similar with those in path models.

So remove the regression analysis. No need to do regression separately. 


```{r}
# follow the tutorial to do this but I am not sure whether it is necessary 
# how to interpret with the centered "info_trust" ? it is so weird
# probably remove this
standardizedSolution(fit1)  
```


### 4.1.4 check the mediation
```{r}
# bootstrap
parameterestimates(fit1, boot.ci.type ='bca.simple', standardized = TRUE)
```


```{r,echo=TRUE,results='hide',error=FALSE,message=FALSE,warning=FALSE}
# using RMediation to check out
library(RMediation)
```


```{r}
medci (mu.x = 0.009, mu.y = 0.009, se.x = 0.003, se.y = 0.232, rho = 0, alpha = 0.1, type = "prodclin")    
```

## 4.2 Part B: information from different sources

categorize the "na_info" and "a_info" into "high" "low" or "0" "1" 

not sure to use words or dummy coding

interaction: 4 conditions. Should i make 3 variables of the dummy coding?

<br>

<br>

<br> 

# **5 Subsidiary analyses**
_ _ _

**adding the controls variables**

For the total information:
  
model2 <-'
c19_anxiety ~ total_info  + total_trust + info_trust + age_cate +gad + health + gender + income
sub_infected~total_info  + total_trust + info_trust + c19_anxiety + age_cate +gad + health + gender +income
'
fit2 <- sem(model2, ordered = c("sub_infected"), data = nocebo_2)
summary(fit2)

<br>

<br>

<br>

### *Notes*
- - - 

link to the Github.